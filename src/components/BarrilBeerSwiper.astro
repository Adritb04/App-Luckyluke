---
import { Image } from 'astro:assets';
import { getImageFromPath } from '../utils/imageLoader';
import type { ImageMetadata } from 'astro';

interface Price {
	label: string;
	price: string;
}

interface Props {
	name: string;
	image?: string | ImageMetadata;
	description?: string;
	prices: Price[];
	abv?: string;
	ibu?: string;
	style?: string;
	country?: string;
	color?: string;
	pairing?: string;
}

const { name, image, description = 'Disponible en barril. Pregunta al personal por detalles.', prices, abv, ibu, style, country, color, pairing } = Astro.props;

// Convertir string a ImageMetadata si es necesario
const imageData = image && typeof image === 'string' ? getImageFromPath(image) : image;
---

<div class="swiper-slide">
	<div class="flip-card barril-flip cursor-pointer">
		<div class="flip-inner">
			<!-- FRONT -->
			<article class="flip-face card-shell p-5 md:p-6 flex flex-col">
				<div class="text-center mb-4">
					<h3 class="text-xl md:text-2xl font-extrabold text-red-500 leading-tight">{name}</h3>
				</div>
				
				<div class="flex-1 flex items-center justify-center">
					{imageData ? (
						<Image 
							src={imageData as ImageMetadata} 
							alt={name}
							width={300}
							height={300}
							format="webp"
							quality={80}
							class="max-h-64 w-auto object-contain" 
							loading="lazy"
						/>
					) : (
						<div class="text-white/60 text-sm">Imagen no disponible</div>
					)}
				</div>
				
				<div class="mt-auto">
					<div class="rounded-lg border border-white/10 bg-black/35 overflow-hidden">
						{prices.map((p, i) => (
							<div class={`flex items-center justify-between px-3 py-2.5 ${i !== prices.length - 1 ? 'border-b border-white/5' : ''}`}>
								<span class="text-xs md:text-sm text-white/70 font-bratton">{p.label}</span>
								<span class="font-bold text-sm md:text-base text-white">{p.price}</span>
							</div>
						))}
					</div>
					<span class="text-xs text-white/70 bg-black/50 border border-white/10 px-3 py-1.5 rounded-full mt-4 inline-block">
						Toca para ver detalles
					</span>
				</div>
			</article>

			<!-- BACK -->
			<article class="flip-face flip-back card-shell p-5 md:p-6 flex flex-col">
				<div class="flex items-start justify-between gap-3 mb-3">
					<h3 class="text-xl md:text-2xl font-bold text-red-500 leading-tight">{name}</h3>
					<span class="text-xs text-white/70 bg-black/50 border border-white/10 px-3 py-1.5 rounded-full">Volver</span>
				</div>
				
				<p class="text-sm md:text-base text-white/85 leading-relaxed mb-3">
					{description}
				</p>
				
				<!-- Chips de info -->
				<div class="flex flex-wrap gap-2 mb-3">
					{abv && (
						<span class="px-3 py-1.5 text-xs rounded-full border border-white/10 bg-black/40 text-white/80">
							ABV: {abv}
						</span>
					)}
					{ibu && (
						<span class="px-3 py-1.5 text-xs rounded-full border border-white/10 bg-black/40 text-white/80">
							IBU: {ibu}
						</span>
					)}
					{color && (
						<span class="px-3 py-1.5 text-xs rounded-full border border-white/10 bg-black/40 text-white/80">
							{color}
						</span>
					)}
					{style && (
						<span class="px-3 py-1.5 text-xs rounded-full border border-white/10 bg-black/40 text-white/80">
							{style}
						</span>
					)}
					{country && (
						<span class="px-3 py-1.5 text-xs rounded-full border border-white/10 bg-black/40 text-white/80">
							{country}
						</span>
					)}
				</div>
				
				<!-- Maridaje -->
				{pairing && (
					<div class="mb-3 p-3 rounded-lg border border-red-600/20 bg-red-950/20">
						<div class="text-xs font-bold text-red-400 tracking-wide mb-2">üç∑ MARIDAJE</div>
						<p class="text-sm md:text-base text-white/85 leading-relaxed">{pairing}</p>
					</div>
				)}
				
				<!-- Precios -->
				<div class="mt-auto">
					<div class="text-xs font-bold text-red-400 tracking-wide mb-2">FORMATOS</div>
					<div class="rounded-lg border border-white/10 bg-black/35 overflow-hidden">
						{prices.map((p, i) => (
							<div class={`flex items-center justify-between px-3 py-2.5 ${i !== prices.length - 1 ? 'border-b border-white/5' : ''}`}>
								<span class="text-xs md:text-sm text-white/70 font-bratton">{p.label}</span>
								<span class="font-bold text-sm md:text-base text-white">{p.price}</span>
							</div>
						))}
					</div>
				</div>
			</article>
		</div>
	</div>
</div>

<style>
	.flip-card {
		perspective: 1000px;
		height: 500px;
	}

	.flip-inner {
		position: relative;
		width: 100%;
		height: 100%;
		transition: transform 0.6s;
		transform-style: preserve-3d;
	}

	.barril-flip.is-flipped .flip-inner {
		transform: rotateY(180deg);
	}

	.flip-face {
		position: absolute;
		width: 100%;
		height: 100%;
		backface-visibility: hidden;
		-webkit-backface-visibility: hidden;
	}

	.flip-back {
		transform: rotateY(180deg);
	}
</style>
