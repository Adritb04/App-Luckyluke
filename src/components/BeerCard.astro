---
import { Image } from 'astro:assets';
import { getImageFromPath } from '../utils/imageLoader';
import type { ImageMetadata } from 'astro';

interface Props {
	name: string;
	format?: string;
	price: string;
	image?: string | ImageMetadata;
	description?: string;
	abv?: string;
	ibu?: string;
	style?: string;
	country?: string;
	tags?: string[];
}

const { name, format = '', price, image, description = 'Sin descripción disponible.', abv, ibu, style, country, tags = [] } = Astro.props;

// Convertir string a ImageMetadata si es necesario
const imageData = image && typeof image === 'string' ? getImageFromPath(image) : image;
---

<div class="swiper-slide">
	<div class="flip-card beer-flip cursor-pointer" data-tags={tags.join(',')}>
		<div class="flip-inner">
			<!-- FRONT: nombre + imagen + formato/precio -->
			<article class="flip-face card-shell p-5 md:p-6 flex flex-col">
				<div class="text-center">
					<h3 class="text-xl md:text-2xl font-extrabold text-red-500 leading-tight">{name}</h3>
				</div>
				
				<div class="flex-1 flex items-center justify-center my-4">
					{imageData ? (
						<Image 
							src={imageData as ImageMetadata} 
							alt={name}
							width={300}
							height={300}
							format="webp"
							quality={80}
							class="max-h-64 w-auto object-contain" 
							loading="lazy" 
						/>
					) : (
						<div class="text-white/60 text-sm">Imagen no disponible</div>
					)}
				</div>
				
				<div class="text-center">
					{format && <div class="text-sm md:text-base text-white/90">{format}</div>}
					<div class="text-lg md:text-xl font-black text-white mt-2">{price}</div>
					<span class="text-xs text-white/70 bg-black/50 border border-white/10 px-3 py-1.5 rounded-full mt-4 inline-block">
						Toca para ver detalles
					</span>
				</div>
			</article>

			<!-- BACK: descripción + datos -->
			<article class="flip-face flip-back card-shell p-5 md:p-6 flex flex-col">
				<!-- Arriba: nombre + volver -->
				<div class="flex items-start justify-between gap-3">
					<h3 class="text-xl md:text-2xl font-bold text-red-500 leading-tight">{name}</h3>
					<span class="text-xs text-white/70 bg-black/50 border border-white/10 px-3 py-1.5 rounded-full">Volver</span>
				</div>
				
				<!-- Cuerpo: descripción -->
				<p class="mt-3 text-sm md:text-base text-white/85 leading-relaxed">
					{description}
				</p>
				
				<!-- Datos en vertical (label rojo, valor blanco) -->
				<div class="mt-4 space-y-2 text-sm md:text-base">
					{abv && (
						<div class="flex justify-between gap-4">
							<span class="text-red-500 font-semibold">ABV</span>
							<span class="text-white/90 font-medium">{abv}</span>
						</div>
					)}
					{ibu && (
						<div class="flex justify-between gap-4">
							<span class="text-red-500 font-semibold">IBU</span>
							<span class="text-white/90 font-medium">{ibu}</span>
						</div>
					)}
					{style && (
						<div class="flex justify-between gap-4">
							<span class="text-red-500 font-semibold">Estilo</span>
							<span class="text-white/90 font-medium">{style}</span>
						</div>
					)}
					{country && (
						<div class="flex justify-between gap-4">
							<span class="text-red-500 font-semibold">País</span>
							<span class="text-white/90 font-medium">{country}</span>
						</div>
					)}
				
				<!-- Precio abajo -->
				<div class="mt-auto pt-4 text-center">
					{format && <div class="text-sm md:text-base text-white/90">{format}</div>}
					<div class="text-lg md:text-xl font-black text-white mt-2">{price}</div>
				</div>
			</article>
		</div>
	</div>
</div>

<style>
	.flip-card {
		perspective: 1000px;
		height: 500px;
	}

	.flip-inner {
		position: relative;
		width: 100%;
		height: 100%;
		transition: transform 0.6s;
		transform-style: preserve-3d;
	}

	.beer-flip.flipped .flip-inner {
		transform: rotateY(180deg);
	}

	.flip-face {
		position: absolute;
		width: 100%;
		height: 100%;
		backface-visibility: hidden;
		-webkit-backface-visibility: hidden;
	}

	.flip-back {
		transform: rotateY(180deg);
	}

	.card-shell {
		background: linear-gradient(135deg, rgba(20,20,20,0.95) 0%, rgba(40,10,10,0.9) 100%);
		border: 1px solid rgba(255,255,255,0.1);
		border-radius: 12px;
		box-shadow: 0 8px 32px rgba(0,0,0,0.3);
	}
</style>

<script>
	document.addEventListener('astro:page-load', () => {
		const cards = document.querySelectorAll('.beer-flip');
		
		cards.forEach(card => {
			card.addEventListener('click', () => {
				card.classList.toggle('flipped');
			});
		});
	});
</script>
